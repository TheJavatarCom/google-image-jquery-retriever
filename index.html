<html>
<head>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.3.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/jumbotron-narrow.css"/>
	<style>
	body {
		text-align:center;
	}
	</style>
</head>
<body>

<div class="jumbotron">
    <input type="text" name="bookName"><br/>
    <p>
        <a href="javascript:refreshCovers(-8)">show previous</a> | <a href="javascript:refreshCovers(8)">load more</a>
    </p><br/>
</div>

<img id="0" width="150px" name="0">
<img id="1" width="150px" name="1">
<img id="2" width="150px" name="2">
<img id="3" width="150px" name="3"><br/>
<img id="4" width="150px" name="4">
<img id="5" width="150px" name="5">
<img id="6" width="150px" name="6">
<img id="7" width="150px" name="7">

<script>

var lastQueriedName;
var currentSearchPosition = 0;

$("input").on("change keyup paste", function() {
	refreshCovers(0);
});

function refreshCovers(shift) {
	var bookName = $("input").val();
	if (bookName !== "") {
		bookName = bookName.replace(" ", "%20");
		queryGoogleForPictures(bookName, calculateStartPosition(bookName, shift));
	}
}

function calculateStartPosition(bookName, shift) {
	if (lastQueriedName === bookName) {
		currentSearchPosition += shift;
		if (currentSearchPosition < 0) {
			currentSearchPosition = 0;
		}
		if (currentSearchPosition >= 100) {
			currentSearchPosition = 92;
		}
	} else {
		lastQueriedName = bookName;
		currentSearchPosition = 0;
	}
	return currentSearchPosition;
}

function queryGoogleForPictures(bookName, position) {
	$.ajax({
		url: 'https://ajax.googleapis.com/ajax/services/search/images',
		dataType: "jsonp",
		data: {
			v: "1.0",
			rsz: 8,
			hl: "pl",
			start: position,
			q: bookName
		},
		success: function(response) {
			if (response.responseData === null) {
				alert('Sorry no more results!');
			} else {
				for (i = 0; i <= 8; i++) {
					$("#"+i).attr("src", response.responseData.results[i].unescapedUrl);
				}
			}
		}
	});
}

</script>
</body>
</html>